# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –≤—Ö–æ–¥–æ–º

## –ü—Ä–æ–±–ª–µ–º–∞: "Failed to fetch"

### –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å DevTools Console

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/signin`
2. –ù–∞–∂–º–∏—Ç–µ **F12** (–∏–ª–∏ Cmd+Option+I –Ω–∞ Mac)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Console**
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏
5. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏

### –®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É

#### –í–∞—Ä–∏–∞–Ω—Ç A: CORS Error

**–°–∏–º–ø—Ç–æ–º—ã –≤ –∫–æ–Ω—Å–æ–ª–∏:**
```
Access to fetch at 'https://birson.tgapp.online/api/v1/login' from origin 
'http://localhost:3000' has been blocked by CORS policy
```

**–†–µ—à–µ–Ω–∏–µ:**
–ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –Ω–∞ –±—ç–∫–µ–Ω–¥–µ. –í Rails:

```ruby
# config/initializers/cors.rb
Rails.application.config.middleware.insert_before 0, Rack::Cors do
  allow do
    origins 'http://localhost:3000', 'http://localhost:5173'
    
    resource '*',
      headers: :any,
      methods: [:get, :post, :put, :patch, :delete, :options, :head],
      expose: ['Authorization'],  # ‚Üê –í–ê–ñ–ù–û –¥–ª—è JWT —Ç–æ–∫–µ–Ω–∞
      credentials: true
  end
end
```

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å gem –≤ Gemfile:
```ruby
gem 'rack-cors'
```

---

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ë—ç–∫–µ–Ω–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–°–∏–º–ø—Ç–æ–º—ã –≤ –∫–æ–Ω—Å–æ–ª–∏:**
```
Failed to fetch
ERR_CONNECTION_REFUSED
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±—ç–∫–µ–Ω–¥–∞
curl https://birson.tgapp.online/api/v1/me

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –±—ç–∫–µ–Ω–¥ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Rails —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL (–º–æ–∂–µ—Ç –±—ã—Ç—å http –≤–º–µ—Å—Ç–æ https)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª/VPN

---

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

**–°–∏–º–ø—Ç–æ–º—ã –≤ –∫–æ–Ω—Å–æ–ª–∏:**
```
400 Bad Request
422 Unprocessable Entity
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞:**
–ó–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∞–∫–∏–º:
```json
POST /api/v1/login
Content-Type: application/json

{
  "user": {
    "email": "test@example.com",
    "password": "password123"
  }
}
```

---

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network Tab

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí **Network**
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏
3. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å `login`
4. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ

**–ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å:**

| –°—Ç–∞—Ç—É—Å | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|---------|
| **(failed)** | CORS –∏–ª–∏ —Å–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ | –°–º. –≤—ã—à–µ |
| **401** | –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ credentials |
| **404** | –ù–µ–≤–µ—Ä–Ω—ã–π URL | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ—É—Ç –≤ Rails |
| **500** | –û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ | –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Rails |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–µ–Ω–¥–∞ –≤—Ä—É—á–Ω—É—é

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

```bash
curl -i https://birson.tgapp.online/api/v1/me
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: 401 (–Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Ç.–∫. –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã)
- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤–∫–ª—é—á–∞—é—Ç CORS headers

### –¢–µ—Å—Ç 2: –ü–æ–ø—ã—Ç–∫–∞ –ª–æ–≥–∏–Ω–∞

```bash
curl -X POST https://birson.tgapp.online/api/v1/login \
  -H "Content-Type: application/json" \
  -d '{
    "user": {
      "email": "test@example.com",
      "password": "password123"
    }
  }' \
  -v
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: 200 –∏–ª–∏ 201
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: `Authorization: Bearer <token>`
- Body: JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üîÑ –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

–ï—Å–ª–∏ –±—ç–∫–µ–Ω–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±—Ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

–í `src/context/AuthContext.tsx` –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–µ–Ω–∏—Ç–µ login:

```typescript
const login = async (email: string, password: string) => {
  // ‚ö†Ô∏è –¢–û–õ–¨–ö–û –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò!
  console.log('üß™ Using mock login');
  
  const mockUser = {
    id: '1',
    email: email,
    name: '–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
    role: 'admin',
  };
  
  const mockToken = `mock_jwt_${Date.now()}`;
  tokenManager.set(mockToken);
  setUser(mockUser);
};
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π STOContext

–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ `ProtectedRoute` –≤ `App.tsx` ‚Äî –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞–Ω—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –ª–æ–≥–∏–Ω–∞.

---

## ‚úÖ Checklist –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –ë—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–≤–∫–ª—é—á–∞—è `expose: ['Authorization']`)
- [ ] URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `https://birson.tgapp.online/api/v1`
- [ ] Devise + Devise-JWT –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
- [ ] gem 'rack-cors' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] Console –≤ DevTools –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–æ–≥–∏ (üîê, üì°, üîë, ‚úÖ)

---

## üìû –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools Console
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è (üîê, üì°, ‚ùå)
3. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools Network
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞ `login`
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Rails —Å–µ—Ä–≤–µ—Ä–∞

**–ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- CORS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Üí –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ rack-cors
- –ë—ç–∫–µ–Ω–¥ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ devise-jwt
- –ù–µ–≤–µ—Ä–Ω—ã–π URL ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ routes.rb
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ http:// –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ dev

---

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ –≤ Console –±—Ä–∞—É–∑–µ—Ä–∞ (–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /signin):

```javascript
// –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
fetch('https://birson.tgapp.online/api/v1/me')
  .then(r => console.log('‚úÖ Backend –¥–æ—Å—Ç—É–ø–µ–Ω, —Å—Ç–∞—Ç—É—Å:', r.status))
  .catch(e => console.error('‚ùå Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', e.message));

// –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ login endpoint
fetch('https://birson.tgapp.online/api/v1/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    user: { email: 'test@test.com', password: 'test' }
  })
})
  .then(r => console.log('üì° Login endpoint –æ—Ç–≤–µ—Ç–∏–ª, —Å—Ç–∞—Ç—É—Å:', r.status))
  .catch(e => console.error('‚ùå Login endpoint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', e.message));
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ **CORS error** ‚Üí –±—ç–∫–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ CORS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.
–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ **Failed to fetch** ‚Üí –±—ç–∫–µ–Ω–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.


