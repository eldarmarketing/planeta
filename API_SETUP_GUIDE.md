# üöÄ –ì–∞–π–¥ –ø–æ –∑–∞–ø—É—Å–∫—É —Å API

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API

API —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `https://birson.tgapp.online/api/v1`

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –±–∞–∑–æ–≤—ã–π URL, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `src/lib/apiClient.ts`:

```typescript
const BASE_URL = 'https://your-backend-url.com/api/v1';
```

### 3. –ó–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞

```bash
npm run dev
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000`

### 4. –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥

1. –û—Ç–∫—Ä–æ–π—Ç–µ `/signin`
2. –í–≤–µ–¥–∏—Ç–µ credentials (–µ—Å–ª–∏ –±—ç–∫–µ–Ω–¥ –≥–æ—Ç–æ–≤)
3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã

---

## üîß –†–∞–±–æ—Ç–∞ —Å API –∏ –º–æ–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### –†–µ–∂–∏–º 1: –° —Ä–µ–∞–ª—å–Ω—ã–º API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **APIContext** –∏ —Ö—É–∫–∏:

```typescript
import { useAPI } from './context/APIContext';

function MyComponent() {
  const { clients, clientsLoading, createClient } = useAPI();
  
  // –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å –±—ç–∫–µ–Ω–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  if (clientsLoading) return <Loader />;
  
  return <ClientsList clients={clients} />;
}
```

### –†–µ–∂–∏–º 2: –° –º–æ–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ –±—ç–∫–µ–Ω–¥–∞)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **STOContext** (—Å—Ç–∞—Ä—ã–π):

```typescript
import { useClients } from './context/STOContext';

function MyComponent() {
  const { clients, addClient } = useClients();
  
  // –î–∞–Ω–Ω—ã–µ –∏–∑ localStorage (–º–æ–∫–∏)
  return <ClientsList clients={clients} />;
}
```

---

## üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞ `https://birson.tgapp.online/api/v1`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –µ—Å—Ç—å `Authorization: Bearer <token>`

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### ‚úÖ –õ–æ–≥–∏–Ω
```
POST /api/v1/login
Body: { "user": { "email": "test@example.ru", "password": "password" } }
–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: 200 + JWT token –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
```

#### ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
```
GET /api/v1/clients
Headers: { "Authorization": "Bearer <token>" }
–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: 200 + { data: [...], meta: {...} }
```

#### ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
```
POST /api/v1/clients
Headers: { "Authorization": "Bearer <token>" }
Body: { "client": { "name": "–¢–µ—Å—Ç", "phone": "+79991234567" } }
–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: 201 + { data: {...} }
```

---

## ‚ö†Ô∏è Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: CORS Error

**–°–∏–º–ø—Ç–æ–º:**
```
Access to fetch at 'https://birson.tgapp.online/api/v1/...' from origin 'http://localhost:3000' 
has been blocked by CORS policy
```

**–†–µ—à–µ–Ω–∏–µ:**
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –Ω–∞ –±—ç–∫–µ–Ω–¥–µ. –í Rails:

```ruby
# config/initializers/cors.rb
Rails.application.config.middleware.insert_before 0, Rack::Cors do
  allow do
    origins 'http://localhost:3000', 'https://your-frontend-domain.com'
    resource '*',
      headers: :any,
      methods: [:get, :post, :put, :patch, :delete, :options, :head],
      credentials: true
  end
end
```

### –ü—Ä–æ–±–ª–µ–º–∞: 401 Unauthorized

**–°–∏–º–ø—Ç–æ–º:** –í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 401

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω: `localStorage.getItem('planeta_auth_token')`
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–π—Ç–∏ –∏ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è JWT —Ç–æ–∫–µ–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º:** Loading –∫—Ä—É—Ç–∏—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—à–∏–±–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab ‚Äî –¥–æ—Ö–æ–¥—è—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å—ã –¥–æ –±—ç–∫–µ–Ω–¥–∞
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±—ç–∫–µ–Ω–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: JWT —Ç–æ–∫–µ–Ω –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç

**–°–∏–º–ø—Ç–æ–º:** –ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

**–†–µ—à–µ–Ω–∏–µ:**
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`.

–û–±–Ω–æ–≤–∏—Ç–µ `AuthContext.tsx`:

```typescript
const login = async (email: string, password: string) => {
  const response = await fetch('https://birson.tgapp.online/api/v1/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user: { email, password } })
  });

  const authHeader = response.headers.get('Authorization');
  const token = authHeader?.replace('Bearer ', '');
  
  if (token) {
    tokenManager.set(token);
    // ...
  }
};
```

---

## üì¶ Production Build

### 1. Build –ø—Ä–æ–µ–∫—Ç–∞

```bash
npm run build
```

### 2. Preview production build

```bash
npm run preview
```

### 3. Deploy

–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ `dist/` –Ω–∞ –≤–∞—à —Ö–æ—Å—Ç–∏–Ω–≥ (Netlify, Vercel, etc.)

**–í–∞–∂–Ω–æ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `BASE_URL` –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è production.

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

–¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `localStorage`. –î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `httpOnly cookies`:

```typescript
// –í apiClient.ts
config.credentials = 'include'; // –î–ª—è cookies
```

### 2. HTTPS

–í production –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è API endpoints.

### 3. Refresh Token

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ access token. –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å refresh token –º–µ—Ö–∞–Ω–∏–∑–º.

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `API_INTEGRATION.md` ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `API_SPEC.md` ‚Äî –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –±—ç–∫–µ–Ω–¥ API

---

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] –ë—ç–∫–µ–Ω–¥ API –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
- [ ] JWT —Ç–æ–∫–µ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –í—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (401, 403, 500)
- [ ] Loading —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [ ] Production build —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] BASE_URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è production

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π API –∫–ª–∏–µ–Ω—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π.

**–ö–æ–Ω—Ç–∞–∫—Ç:** –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äî —Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ senior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.


